{{- $style := "auto" -}}
{{- if and (isset .Site.Params "style") (ne .Site.Params.style "") -}}
{{- $style = .Site.Params.style | lower -}}
{{- end -}}
<link rel="dns-prefetch" href="//res.cloudinary.com/">
<link rel="dns-prefetch" href="//fonts.gstatic.com/">
<link rel="preload" href="https://fonts.gstatic.com/s/averiasanslibre/v8/ga6SaxZG_G5OvCf_rt7FH3B6BHLMEd31N5cXL5I.woff2" as="font" crossorigin>
<link rel="preload" href="https://fonts.gstatic.com/s/averiasanslibre/v8/ga6XaxZG_G5OvCf_rt7FH3B6BHLMEdVOEoI.woff2" as="font" crossorigin>
<link rel="preload" href="https://fonts.gstatic.com/s/sourcecodepro/v11/HI_XiYsKILxRpg3hIP6sJ7fM7PqtzsjDs-cq.woff2" as="font" crossorigin>
{{- $coreCSS := resources.Get "css/style.css" -}}
{{- if ne $style "light" -}}
    {{- $darkStyle := resources.Get "css/dark-style.css" -}}
    {{- if eq $style "dark" -}}
        {{- $coreCSS = slice $coreCSS $darkStyle | resources.Concat "css/tmp_style.css" -}}
    {{- else -}}
        {{- $darkStyleBegin := (print "@media (prefers-color-scheme: dark) {") | resources.FromString "css/tmp_style_dark_begin.css" -}}
        {{- $darkStyleEnd := (print "}") | resources.FromString "css/tmp_style_dark_end.css" -}}
        {{- $darkStyleCSS := slice $darkStyleBegin $darkStyle | resources.Concat "css/tmp_style_dark_.css" -}}
        {{- $darkStyleCSS = slice $darkStyleCSS $darkStyleEnd | resources.Concat "css/tmp_style_dark.css" -}}
        {{- $coreCSS = slice $coreCSS $darkStyleCSS | resources.Concat "css/tmp_style.css" -}}
    {{- end -}}
{{- end -}}

{{- $coreCSS = slice $coreCSS | resources.Concat "css/tmp_core.css" -}}

{{- with partial "custom-css.html" . -}}
    {{- if ne . "" -}}
        {{- $coreCSS = slice $coreCSS . | resources.Concat "css/custom_core.css" -}}
    {{- end -}}
{{- end -}}

{{- $coreCSS = slice $coreCSS ("" | resources.FromString "css/_core.css") | resources.Concat "css/core.css" -}}
{{- $coreCSS = $coreCSS | resources.Minify | resources.Fingerprint "sha384" -}}

<link rel="preload" href="{{ $coreCSS.RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ $coreCSS.RelPermalink }}" integrity="{{ $coreCSS.Data.Integrity }}"></noscript>
{{ $criticalCSS := resources.Get "css/critical-style.css" }}
<style type="text/css">{{ $criticalCSS.Content | safeCSS }}</style>